<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Express.js Interactive Playground</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
        color: white;
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .tabs {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 20px;
        justify-content: center;
      }

      .tab-btn {
        padding: 12px 24px;
        background: rgba(255, 255, 255, 0.2);
        border: none;
        border-radius: 25px;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
        font-weight: 500;
      }

      .tab-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
      }

      .tab-btn.active {
        background: rgba(255, 255, 255, 0.9);
        color: #333;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .tab-content {
        display: none;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 30px;
        backdrop-filter: blur(10px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .tab-content.active {
        display: block;
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .section {
        margin-bottom: 30px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 10px;
        border-left: 4px solid #667eea;
      }

      .section h3 {
        color: #667eea;
        margin-bottom: 15px;
        font-size: 1.4rem;
      }

      .code-block {
        background: #2d3748;
        color: #e2e8f0;
        padding: 40px;
        border-radius: 8px;
        margin: 15px 0;
        overflow-x: auto;
        font-family: "Monaco", "Consolas", monospace;
        font-size: 16px;
        line-height: 1.6;
        min-height: 400px;
      }

      .interactive-area {
        background: #fff;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        padding: 20px;
        margin: 15px 0;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
        color: #374151;
      }

      .form-group input,
      .form-group textarea,
      .form-group select {
        width: 100%;
        padding: 10px;
        border: 2px solid #d1d5db;
        border-radius: 6px;
        font-size: 14px;
        transition: border-color 0.2s ease;
      }

      .form-group input:focus,
      .form-group textarea:focus,
      .form-group select:focus {
        outline: none;
        border-color: #667eea;
      }

      .btn {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s ease;
        margin-right: 10px;
        margin-bottom: 10px;
      }

      .btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      }

      .output {
        background: #1a202c;
        color: #e2e8f0;
        padding: 15px;
        border-radius: 6px;
        margin-top: 15px;
        font-family: "Monaco", "Consolas", monospace;
        font-size: 13px;
        max-height: 300px;
        overflow-y: auto;
      }

      .success {
        color: #48bb78;
      }
      .error {
        color: #f56565;
      }
      .info {
        color: #4299e1;
      }
      .warning {
        color: #ed8936;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
      }

      .card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        border-left: 4px solid #667eea;
      }

      .status-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 8px;
      }

      .status-online {
        background: #48bb78;
      }
      .status-offline {
        background: #f56565;
      }
      .status-pending {
        background: #ed8936;
      }

      .badge {
        background: #667eea;
        color: white;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 500;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üöÄ Express.js Interactive Playground</h1>
        <p>Learn JWT, Cookies, Middleware & Database Operations</p>
      </div>

      <div class="tabs">
        <button class="tab-btn active" data-tab="basics">Express Basics</button>
        <button class="tab-btn" data-tab="middleware">Middleware</button>
        <button class="tab-btn" data-tab="auth">JWT Auth</button>
        <button class="tab-btn" data-tab="cookies">Cookies</button>
        <button class="tab-btn" data-tab="database">Database</button>
        <button class="tab-btn" data-tab="simulator">API Simulator</button>
      </div>

      <!-- Express Basics Tab -->
      <div class="tab-content active" id="basics">
        <div class="section">
          <h3>üåü Express.js Fundamentals</h3>
          <p>
            Express.js is a minimal and flexible Node.js web application
            framework. Let's explore the basics!
          </p>

          <div class="code-block">
            const express = require('express'); const app = express(); const
            PORT = 3000; // Basic middleware app.use(express.json());
            app.use(express.urlencoded({ extended: true })); // Basic route
            app.get('/', (req, res) => { res.json({ message: 'Welcome to
            Express.js!' }); }); // Route with parameters app.get('/user/:id',
            (req, res) => { const { id } = req.params; res.json({ userId: id,
            message: `Hello user ${id}!` }); }); // POST route
            app.post('/users', (req, res) => { const { name, email } = req.body;
            res.json({ message: 'User created successfully', user: { name,
            email, id: Date.now() } }); }); app.listen(PORT, () => {
            console.log(`Server running on port ${PORT}`); });
          </div>

          <div class="interactive-area">
            <h4>üéØ Try Express Routes</h4>
            <div class="form-group">
              <label>Route Type:</label>
              <select id="routeType">
                <option value="GET">GET</option>
                <option value="POST">POST</option>
                <option value="PUT">PUT</option>
                <option value="DELETE">DELETE</option>
              </select>
            </div>
            <div class="form-group">
              <label>Route Path:</label>
              <input
                type="text"
                id="routePath"
                value="/api/test"
                placeholder="/api/endpoint"
              />
            </div>
            <div class="form-group">
              <label>Request Body (for POST/PUT):</label>
              <textarea
                id="requestBody"
                placeholder='{"name": "John", "email": "john@example.com"}'
              ></textarea>
            </div>
            <button class="btn" onclick="simulateExpressRoute()">
              Test Route
            </button>
            <div class="output" id="expressOutput"></div>
          </div>
        </div>
      </div>

      <!-- Middleware Tab -->
      <div class="tab-content" id="middleware">
        <div class="section">
          <h3>‚öôÔ∏è Express Middleware</h3>
          <p>
            Middleware functions execute during the request-response cycle. They
            can modify requests, responses, or end the cycle.
          </p>

          <div class="code-block">
            // Custom logging middleware const logger = (req, res, next) => {
            const timestamp = new Date().toISOString();
            console.log(`${timestamp} - ${req.method} ${req.path}`); next(); //
            Call next() to continue to next middleware }; // Authentication
            middleware const authenticate = (req, res, next) => { const token =
            req.headers.authorization; if (!token) { return
            res.status(401).json({ error: 'No token provided' }); } // Verify
            token logic here req.user = { id: 1, name: 'John Doe' }; // Mock
            user next(); }; // Error handling middleware const errorHandler =
            (err, req, res, next) => { console.error(err.stack);
            res.status(500).json({ error: 'Something went wrong!', message:
            err.message }); }; // Apply middleware app.use(logger);
            app.use('/protected', authenticate); app.use(errorHandler); //
            Protected route app.get('/protected/profile', (req, res) => {
            res.json({ user: req.user }); });
          </div>

          <div class="interactive-area">
            <h4>üõ†Ô∏è Middleware Chain Simulator</h4>
            <div class="grid">
              <div class="card">
                <h5>Available Middleware</h5>
                <div>
                  <label
                    ><input type="checkbox" id="loggerMw" checked />
                    Logger</label
                  ><br />
                  <label
                    ><input type="checkbox" id="authMw" /> Authentication</label
                  ><br />
                  <label><input type="checkbox" id="corsMw" /> CORS</label
                  ><br />
                  <label
                    ><input type="checkbox" id="rateLimitMw" /> Rate
                    Limiting</label
                  ><br />
                  <label
                    ><input type="checkbox" id="validationMw" />
                    Validation</label
                  >
                </div>
              </div>
              <div class="card">
                <h5>Request Simulation</h5>
                <div class="form-group">
                  <label>Endpoint:</label>
                  <input
                    type="text"
                    id="middlewareEndpoint"
                    value="/api/users"
                  />
                </div>
                <div class="form-group">
                  <label>Authorization Header:</label>
                  <input
                    type="text"
                    id="authHeader"
                    placeholder="Bearer your-token"
                  />
                </div>
                <button class="btn" onclick="simulateMiddleware()">
                  Run Middleware Chain
                </button>
              </div>
            </div>
            <div class="output" id="middlewareOutput"></div>
          </div>
        </div>
      </div>

      <!-- JWT Auth Tab -->
      <div class="tab-content" id="auth">
        <div class="section">
          <h3>üîê JWT Authentication</h3>
          <p>
            JSON Web Tokens provide a secure way to transmit information between
            parties. Perfect for stateless authentication!
          </p>

          <div class="code-block">
            const jwt = require('jsonwebtoken'); const bcrypt =
            require('bcrypt'); const JWT_SECRET = 'your-secret-key'; // Use
            environment variable in production! // User login
            app.post('/auth/login', async (req, res) => { try { const { email,
            password } = req.body; // Find user in database (mock) const user =
            await User.findOne({ email }); if (!user) { return
            res.status(401).json({ error: 'Invalid credentials' }); } // Verify
            password const isValid = await bcrypt.compare(password,
            user.password); if (!isValid) { return res.status(401).json({ error:
            'Invalid credentials' }); } // Create JWT token const token =
            jwt.sign( { userId: user.id, email: user.email }, JWT_SECRET, {
            expiresIn: '24h' } ); res.json({ message: 'Login successful', token,
            user: { id: user.id, email: user.email } }); } catch (error) {
            res.status(500).json({ error: 'Login failed' }); } }); // JWT
            verification middleware const verifyJWT = (req, res, next) => {
            const token = req.headers.authorization?.split(' ')[1]; if (!token)
            { return res.status(401).json({ error: 'Access denied. No token
            provided.' }); } try { const decoded = jwt.verify(token,
            JWT_SECRET); req.user = decoded; next(); } catch (error) {
            res.status(400).json({ error: 'Invalid token' }); } };
          </div>

          <div class="interactive-area">
            <h4>üé´ JWT Token Generator & Validator</h4>
            <div class="grid">
              <div class="card">
                <h5>Generate JWT Token</h5>
                <div class="form-group">
                  <label>User ID:</label>
                  <input type="text" id="userId" value="123" />
                </div>
                <div class="form-group">
                  <label>Email:</label>
                  <input type="email" id="userEmail" value="user@example.com" />
                </div>
                <div class="form-group">
                  <label>Secret Key:</label>
                  <input type="text" id="jwtSecret" value="my-secret-key" />
                </div>
                <div class="form-group">
                  <label>Expires In:</label>
                  <select id="expiresIn">
                    <option value="1h">1 hour</option>
                    <option value="24h" selected>24 hours</option>
                    <option value="7d">7 days</option>
                  </select>
                </div>
                <button class="btn" onclick="generateJWT()">
                  Generate Token
                </button>
              </div>
              <div class="card">
                <h5>Validate JWT Token</h5>
                <div class="form-group">
                  <label>JWT Token:</label>
                  <textarea
                    id="jwtToken"
                    placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  ></textarea>
                </div>
                <div class="form-group">
                  <label>Secret Key:</label>
                  <input
                    type="text"
                    id="validateSecret"
                    value="my-secret-key"
                  />
                </div>
                <button class="btn" onclick="validateJWT()">
                  Validate Token
                </button>
              </div>
            </div>
            <div class="output" id="jwtOutput"></div>
          </div>
        </div>
      </div>

      <!-- Cookies Tab -->
      <div class="tab-content" id="cookies">
        <div class="section">
          <h3>üç™ Cookies & Sessions</h3>
          <p>
            Cookies store small pieces of data in the browser. They're essential
            for maintaining user sessions and preferences.
          </p>

          <div class="code-block">
            const cookieParser = require('cookie-parser');
            app.use(cookieParser()); // Set cookie app.post('/set-cookie', (req,
            res) => { res.cookie('username', 'john_doe', { maxAge: 24 * 60 * 60
            * 1000, // 24 hours httpOnly: true, // Prevent XSS attacks secure:
            process.env.NODE_ENV === 'production', // HTTPS only in production
            sameSite: 'strict' // CSRF protection }); res.json({ message:
            'Cookie set successfully' }); }); // Get cookie
            app.get('/get-cookie', (req, res) => { const username =
            req.cookies.username; if (username) { res.json({ username, message:
            'Cookie found!' }); } else { res.json({ message: 'No cookie found'
            }); } }); // Clear cookie app.post('/clear-cookie', (req, res) => {
            res.clearCookie('username'); res.json({ message: 'Cookie cleared'
            }); }); // Session-like behavior with signed cookies
            app.use(cookieParser('secret-signing-key')); app.post('/login',
            (req, res) => { const { username, password } = req.body; // Validate
            credentials (mock) if (username && password) { res.cookie('session',
            { userId: 123, username }, { signed: true, maxAge: 30 * 60 * 1000 //
            30 minutes }); res.json({ message: 'Logged in successfully' }); }
            else { res.status(400).json({ error: 'Invalid credentials' }); } });
          </div>

          <div class="interactive-area">
            <h4>üç™ Cookie Manager</h4>
            <div class="grid">
              <div class="card">
                <h5>Set Cookie</h5>
                <div class="form-group">
                  <label>Cookie Name:</label>
                  <input type="text" id="cookieName" value="username" />
                </div>
                <div class="form-group">
                  <label>Cookie Value:</label>
                  <input type="text" id="cookieValue" value="john_doe" />
                </div>
                <div class="form-group">
                  <label>Max Age (hours):</label>
                  <input type="number" id="maxAge" value="24" />
                </div>
                <div class="form-group">
                  <label
                    ><input type="checkbox" id="httpOnly" checked />
                    HttpOnly</label
                  ><br />
                  <label><input type="checkbox" id="secure" /> Secure</label
                  ><br />
                  <label
                    ><input type="checkbox" id="sameSite" checked />
                    SameSite</label
                  >
                </div>
                <button class="btn" onclick="setCookie()">Set Cookie</button>
              </div>
              <div class="card">
                <h5>Current Cookies</h5>
                <div id="cookieList">
                  <p class="info">No cookies set</p>
                </div>
                <button class="btn" onclick="getAllCookies()">Refresh</button>
                <button class="btn" onclick="clearAllCookies()">
                  Clear All
                </button>
              </div>
            </div>
            <div class="output" id="cookieOutput"></div>
          </div>
        </div>
      </div>

      <!-- Database Tab -->
      <div class="tab-content" id="database">
        <div class="section">
          <h3>üóÑÔ∏è Database Operations</h3>
          <p>
            Learn how to integrate databases with Express.js using popular ORMs
            and query builders.
          </p>

          <div class="code-block">
            // Using Mongoose (MongoDB) const mongoose = require('mongoose');
            const userSchema = new mongoose.Schema({ name: { type: String,
            required: true }, email: { type: String, required: true, unique:
            true }, password: { type: String, required: true }, createdAt: {
            type: Date, default: Date.now } }); const User =
            mongoose.model('User', userSchema); // Create user
            app.post('/users', async (req, res) => { try { const { name, email,
            password } = req.body; const hashedPassword = await
            bcrypt.hash(password, 10); const user = new User({ name, email,
            password: hashedPassword }); await user.save();
            res.status(201).json({ message: 'User created successfully', user: {
            id: user._id, name, email } }); } catch (error) { if (error.code ===
            11000) { res.status(400).json({ error: 'Email already exists' }); }
            else { res.status(500).json({ error: 'Failed to create user' }); } }
            }); // Get users with pagination app.get('/users', async (req, res)
            => { try { const page = parseInt(req.query.page) || 1; const limit =
            parseInt(req.query.limit) || 10; const skip = (page - 1) * limit;
            const users = await User.find({}, '-password') .skip(skip)
            .limit(limit) .sort({ createdAt: -1 }); const total = await
            User.countDocuments(); res.json({ users, pagination: { page, limit,
            total, pages: Math.ceil(total / limit) } }); } catch (error) {
            res.status(500).json({ error: 'Failed to fetch users' }); } }); //
            Update user app.put('/users/:id', async (req, res) => { try { const
            { id } = req.params; const updates = req.body; const user = await
            User.findByIdAndUpdate( id, updates, { new: true, select:
            '-password' } ); if (!user) { return res.status(404).json({ error:
            'User not found' }); } res.json({ message: 'User updated
            successfully', user }); } catch (error) { res.status(500).json({
            error: 'Failed to update user' }); } }); // Delete user
            app.delete('/users/:id', async (req, res) => { try { const { id } =
            req.params; const user = await User.findByIdAndDelete(id); if
            (!user) { return res.status(404).json({ error: 'User not found' });
            } res.json({ message: 'User deleted successfully' }); } catch
            (error) { res.status(500).json({ error: 'Failed to delete user' });
            } });
          </div>

          <div class="interactive-area">
            <h4>üóÉÔ∏è Database Operations Simulator</h4>
            <div class="grid">
              <div class="card">
                <h5>Create User</h5>
                <div class="form-group">
                  <label>Name:</label>
                  <input type="text" id="dbUserName" placeholder="John Doe" />
                </div>
                <div class="form-group">
                  <label>Email:</label>
                  <input
                    type="email"
                    id="dbUserEmail"
                    placeholder="john@example.com"
                  />
                </div>
                <button class="btn" onclick="createUser()">Create User</button>
              </div>
              <div class="card">
                <h5>Database Operations</h5>
                <button class="btn" onclick="getAllUsers()">
                  Get All Users
                </button>
                <button class="btn" onclick="getUserById()">
                  Get User by ID
                </button>
                <button class="btn" onclick="updateUser()">Update User</button>
                <button class="btn" onclick="deleteUser()">Delete User</button>
              </div>
            </div>

            <div class="card">
              <h5>Mock Database</h5>
              <div id="userDatabase">
                <!-- Users will be displayed here -->
              </div>
            </div>
            <div class="output" id="databaseOutput"></div>
          </div>
        </div>
      </div>

      <!-- API Simulator Tab -->
      <div class="tab-content" id="simulator">
        <div class="section">
          <h3>üéÆ Complete API Simulator</h3>
          <p>
            Test all concepts together in this comprehensive API simulation
            environment!
          </p>

          <div class="interactive-area">
            <div class="grid">
              <div class="card">
                <h5>üîê Authentication</h5>
                <div class="form-group">
                  <label>Email:</label>
                  <input
                    type="email"
                    id="loginEmail"
                    value="admin@example.com"
                  />
                </div>
                <div class="form-group">
                  <label>Password:</label>
                  <input
                    type="password"
                    id="loginPassword"
                    value="password123"
                  />
                </div>
                <button class="btn" onclick="simulateLogin()">Login</button>
                <button class="btn" onclick="simulateLogout()">Logout</button>
                <div id="authStatus">
                  <span class="status-indicator status-offline"></span>
                  <span>Not authenticated</span>
                </div>
              </div>

              <div class="card">
                <h5>üìä API Endpoints</h5>
                <div class="form-group">
                  <label>Endpoint:</label>
                  <select id="apiEndpoint">
                    <option value="/api/users">GET /api/users</option>
                    <option value="/api/users/:id">GET /api/users/:id</option>
                    <option value="/api/profile">
                      GET /api/profile (Protected)
                    </option>
                    <option value="/api/admin">
                      GET /api/admin (Admin Only)
                    </option>
                  </select>
                </div>
                <button class="btn" onclick="callAPI()">Call API</button>
              </div>
            </div>

            <div class="card">
              <h5>üìà Request/Response Monitor</h5>
              <div id="requestMonitor">
                <div class="info">No requests made yet</div>
              </div>
            </div>

            <div class="output" id="simulatorOutput"></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Global state
      let currentUser = null;
      let jwtToken = null;
      let mockDatabase = [
        {
          id: 1,
          name: "John Doe",
          email: "john@example.com",
          role: "user",
          createdAt: new Date().toISOString(),
        },
        {
          id: 2,
          name: "Jane Smith",
          email: "jane@example.com",
          role: "admin",
          createdAt: new Date().toISOString(),
        },
      ];
      let requestCounter = 0;

      // Tab switching
      document.querySelectorAll(".tab-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          const tabId = btn.dataset.tab;

          // Remove active classes
          document
            .querySelectorAll(".tab-btn")
            .forEach((b) => b.classList.remove("active"));
          document
            .querySelectorAll(".tab-content")
            .forEach((c) => c.classList.remove("active"));

          // Add active classes
          btn.classList.add("active");
          document.getElementById(tabId).classList.add("active");
        });
      });

      // Express Route Simulator
      function simulateExpressRoute() {
        const routeType = document.getElementById("routeType").value;
        const routePath = document.getElementById("routePath").value;
        const requestBody = document.getElementById("requestBody").value;

        let response = {
          status: 200,
          method: routeType,
          path: routePath,
          timestamp: new Date().toISOString(),
        };

        try {
          if (routeType === "GET") {
            response.data = {
              message: `GET request to ${routePath}`,
              params: {},
            };
          } else if (["POST", "PUT"].includes(routeType)) {
            const body = requestBody ? JSON.parse(requestBody) : {};
            response.data = {
              message: `${routeType} request successful`,
              received: body,
              id: Math.floor(Math.random() * 1000),
            };
          } else if (routeType === "DELETE") {
            response.data = { message: `Resource deleted successfully` };
          }

          displayOutput("expressOutput", response, "success");
        } catch (error) {
          displayOutput(
            "expressOutput",
            {
              error: "Invalid JSON in request body",
              details: error.message,
            },
            "error"
          );
        }
      }

      // Middleware Simulator
      function simulateMiddleware() {
        const endpoint = document.getElementById("middlewareEndpoint").value;
        const authHeader = document.getElementById("authHeader").value;

        const loggerMw = document.getElementById("loggerMw").checked;
        const authMw = document.getElementById("authMw").checked;
        const corsMw = document.getElementById("corsMw").checked;
        const rateLimitMw = document.getElementById("rateLimitMw").checked;
        const validationMw = document.getElementById("validationMw").checked;

        let middlewareChain = [];
        let request = {
          method: "GET",
          path: endpoint,
          headers: { authorization: authHeader },
          timestamp: new Date().toISOString(),
        };

        if (loggerMw) {
          middlewareChain.push("Logger: Request logged");
        }

        if (corsMw) {
          middlewareChain.push("CORS: Headers added");
        }

        if (rateLimitMw) {
          const isRateLimited = Math.random() > 0.8; // 20% chance
          if (isRateLimited) {
            displayOutput(
              "middlewareOutput",
              {
                status: 429,
                error: "Too Many Requests",
                message: "Rate limit exceeded. Try again later.",
                middlewareChain,
              },
              "error"
            );
            return;
          }
          middlewareChain.push("Rate Limit: Request allowed");
        }

        if (validationMw) {
          if (!endpoint.startsWith("/api/")) {
            displayOutput(
              "middlewareOutput",
              {
                status: 400,
                error: "Validation Failed",
                message: "Endpoint must start with /api/",
                middlewareChain,
              },
              "error"
            );
            return;
          }
          middlewareChain.push("Validation: Request validated");
        }

        if (authMw) {
          if (!authHeader || !authHeader.startsWith("Bearer ")) {
            displayOutput(
              "middlewareOutput",
              {
                status: 401,
                error: "Authentication Failed",
                message: "Valid Bearer token required",
                middlewareChain,
              },
              "error"
            );
            return;
          }
          middlewareChain.push("Auth: Token verified");
          request.user = { id: 1, name: "John Doe" };
        }

        middlewareChain.push("Route Handler: Response sent");

        displayOutput(
          "middlewareOutput",
          {
            status: 200,
            message: "Request processed successfully",
            middlewareChain,
            request,
            response: { data: "Success!" },
          },
          "success"
        );
      }

      // JWT Functions
      function generateJWT() {
        const userId = document.getElementById("userId").value;
        const userEmail = document.getElementById("userEmail").value;
        const secret = document.getElementById("jwtSecret").value;
        const expiresIn = document.getElementById("expiresIn").value;

        // Mock JWT generation (in real app, use jsonwebtoken library)
        const header = btoa(JSON.stringify({ alg: "HS256", typ: "JWT" }));
        const payload = btoa(
          JSON.stringify({
            userId,
            email: userEmail,
            exp:
              Math.floor(Date.now() / 1000) +
              (expiresIn === "1h"
                ? 3600
                : expiresIn === "24h"
                ? 86400
                : 604800),
            iat: Math.floor(Date.now() / 1000),
          })
        );
        const signature = btoa(`signature_${secret}_${userId}`);

        const token = `${header}.${payload}.${signature}`;

        displayOutput(
          "jwtOutput",
          {
            message: "JWT Token generated successfully!",
            token,
            payload: JSON.parse(atob(payload)),
            expiresIn,
          },
          "success"
        );

        // Auto-fill validation field
        document.getElementById("jwtToken").value = token;
      }

      function validateJWT() {
        const token = document.getElementById("jwtToken").value.trim();
        const secret = document.getElementById("validateSecret").value;

        if (!token) {
          displayOutput(
            "jwtOutput",
            { error: "Please provide a JWT token" },
            "error"
          );
          return;
        }

        try {
          const parts = token.split(".");
          if (parts.length !== 3) {
            throw new Error("Invalid JWT format");
          }

          const header = JSON.parse(atob(parts[0]));
          const payload = JSON.parse(atob(parts[1]));
          const signature = parts[2];

          // Mock signature verification
          const expectedSignature = btoa(
            `signature_${secret}_${payload.userId}`
          );
          const isValidSignature = signature === expectedSignature;

          // Check expiration
          const now = Math.floor(Date.now() / 1000);
          const isExpired = payload.exp && payload.exp < now;

          if (isExpired) {
            displayOutput(
              "jwtOutput",
              {
                status: "invalid",
                error: "Token has expired",
                payload,
                expiredAt: new Date(payload.exp * 1000).toISOString(),
              },
              "error"
            );
          } else if (!isValidSignature) {
            displayOutput(
              "jwtOutput",
              {
                status: "invalid",
                error: "Invalid signature - token may be tampered with",
                payload,
              },
              "error"
            );
          } else {
            displayOutput(
              "jwtOutput",
              {
                status: "valid",
                message: "JWT token is valid!",
                header,
                payload,
                expiresAt: payload.exp
                  ? new Date(payload.exp * 1000).toISOString()
                  : "No expiration",
              },
              "success"
            );
          }
        } catch (error) {
          displayOutput(
            "jwtOutput",
            {
              error: "Failed to parse JWT token",
              details: error.message,
            },
            "error"
          );
        }
      }

      // Cookie Functions
      function setCookie() {
        const name = document.getElementById("cookieName").value;
        const value = document.getElementById("cookieValue").value;
        const maxAge =
          parseInt(document.getElementById("maxAge").value) * 60 * 60 * 1000; // Convert to milliseconds
        const httpOnly = document.getElementById("httpOnly").checked;
        const secure = document.getElementById("secure").checked;
        const sameSite = document.getElementById("sameSite").checked;

        if (!name || !value) {
          displayOutput(
            "cookieOutput",
            { error: "Cookie name and value are required" },
            "error"
          );
          return;
        }

        // Simulate cookie setting (in real browser, this would set actual cookies)
        const cookieOptions = {
          maxAge,
          httpOnly,
          secure,
          sameSite: sameSite ? "strict" : "lax",
          expires: new Date(Date.now() + maxAge).toISOString(),
        };

        // Store in sessionStorage for demo purposes
        const existingCookies = JSON.parse(
          sessionStorage.getItem("demoCookies") || "{}"
        );
        existingCookies[name] = {
          value,
          options: cookieOptions,
          createdAt: new Date().toISOString(),
        };
        sessionStorage.setItem("demoCookies", JSON.stringify(existingCookies));

        displayOutput(
          "cookieOutput",
          {
            message: `Cookie '${name}' set successfully!`,
            cookie: { name, value },
            options: cookieOptions,
          },
          "success"
        );

        getAllCookies();
      }

      function getAllCookies() {
        const cookies = JSON.parse(
          sessionStorage.getItem("demoCookies") || "{}"
        );
        const cookieList = document.getElementById("cookieList");

        if (Object.keys(cookies).length === 0) {
          cookieList.innerHTML = '<p class="info">No cookies set</p>';
        } else {
          cookieList.innerHTML = Object.entries(cookies)
            .map(
              ([name, data]) => `
                    <div style="padding: 10px; border: 1px solid #ddd; margin: 5px 0; border-radius: 5px;">
                        <strong>${name}</strong>: ${data.value}
                        <br><small>Created: ${new Date(
                          data.createdAt
                        ).toLocaleString()}</small>
                        <br><small>Expires: ${new Date(
                          data.options.expires
                        ).toLocaleString()}</small>
                        <br><span class="badge">${
                          data.options.httpOnly ? "HttpOnly" : "Client-Side"
                        }</span>
                        ${
                          data.options.secure
                            ? '<span class="badge">Secure</span>'
                            : ""
                        }
                        <button class="btn" style="font-size: 11px; padding: 2px 6px; margin-left: 10px;" onclick="deleteCookie('${name}')">Delete</button>
                    </div>
                `
            )
            .join("");
        }
      }

      function deleteCookie(name) {
        const cookies = JSON.parse(
          sessionStorage.getItem("demoCookies") || "{}"
        );
        delete cookies[name];
        sessionStorage.setItem("demoCookies", JSON.stringify(cookies));
        getAllCookies();
        displayOutput(
          "cookieOutput",
          { message: `Cookie '${name}' deleted` },
          "info"
        );
      }

      function clearAllCookies() {
        sessionStorage.removeItem("demoCookies");
        getAllCookies();
        displayOutput(
          "cookieOutput",
          { message: "All cookies cleared" },
          "info"
        );
      }

      // Database Functions
      function createUser() {
        const name = document.getElementById("dbUserName").value.trim();
        const email = document.getElementById("dbUserEmail").value.trim();

        if (!name || !email) {
          displayOutput(
            "databaseOutput",
            { error: "Name and email are required" },
            "error"
          );
          return;
        }

        // Check if email already exists
        if (mockDatabase.find((user) => user.email === email)) {
          displayOutput(
            "databaseOutput",
            { error: "Email already exists" },
            "error"
          );
          return;
        }

        const newUser = {
          id: Math.max(...mockDatabase.map((u) => u.id), 0) + 1,
          name,
          email,
          role: "user",
          createdAt: new Date().toISOString(),
        };

        mockDatabase.push(newUser);
        updateDatabaseDisplay();

        displayOutput(
          "databaseOutput",
          {
            message: "User created successfully!",
            user: newUser,
          },
          "success"
        );

        // Clear form
        document.getElementById("dbUserName").value = "";
        document.getElementById("dbUserEmail").value = "";
      }

      function getAllUsers() {
        displayOutput(
          "databaseOutput",
          {
            message: "Users retrieved successfully",
            count: mockDatabase.length,
            users: mockDatabase,
          },
          "success"
        );
      }

      function getUserById() {
        const id = parseInt(prompt("Enter user ID:"));
        if (!id) return;

        const user = mockDatabase.find((u) => u.id === id);
        if (user) {
          displayOutput(
            "databaseOutput",
            {
              message: "User found!",
              user,
            },
            "success"
          );
        } else {
          displayOutput(
            "databaseOutput",
            {
              error: "User not found",
              searchedId: id,
            },
            "error"
          );
        }
      }

      function updateUser() {
        const id = parseInt(prompt("Enter user ID to update:"));
        if (!id) return;

        const userIndex = mockDatabase.findIndex((u) => u.id === id);
        if (userIndex === -1) {
          displayOutput("databaseOutput", { error: "User not found" }, "error");
          return;
        }

        const newName = prompt("Enter new name (leave empty to keep current):");
        if (newName) {
          mockDatabase[userIndex].name = newName;
          mockDatabase[userIndex].updatedAt = new Date().toISOString();
        }

        updateDatabaseDisplay();
        displayOutput(
          "databaseOutput",
          {
            message: "User updated successfully!",
            user: mockDatabase[userIndex],
          },
          "success"
        );
      }

      function deleteUser() {
        const id = parseInt(prompt("Enter user ID to delete:"));
        if (!id) return;

        const userIndex = mockDatabase.findIndex((u) => u.id === id);
        if (userIndex === -1) {
          displayOutput("databaseOutput", { error: "User not found" }, "error");
          return;
        }

        const deletedUser = mockDatabase.splice(userIndex, 1)[0];
        updateDatabaseDisplay();

        displayOutput(
          "databaseOutput",
          {
            message: "User deleted successfully!",
            deletedUser,
          },
          "success"
        );
      }

      function updateDatabaseDisplay() {
        const dbContainer = document.getElementById("userDatabase");
        dbContainer.innerHTML = `
                <h6>Users (${mockDatabase.length})</h6>
                ${mockDatabase
                  .map(
                    (user) => `
                    <div style="padding: 10px; border-left: 3px solid #667eea; margin: 5px 0; background: #f8f9fa;">
                        <strong>ID: ${user.id}</strong> - ${user.name} (${
                      user.email
                    })
                        <br><small>Role: ${user.role} | Created: ${new Date(
                      user.createdAt
                    ).toLocaleDateString()}</small>
                        ${
                          user.updatedAt
                            ? `<br><small>Updated: ${new Date(
                                user.updatedAt
                              ).toLocaleDateString()}</small>`
                            : ""
                        }
                    </div>
                `
                  )
                  .join("")}
            `;
      }

      // API Simulator Functions
      function simulateLogin() {
        const email = document.getElementById("loginEmail").value;
        const password = document.getElementById("loginPassword").value;

        // Mock authentication
        const user = mockDatabase.find((u) => u.email === email);
        if (!user || password !== "password123") {
          displayOutput(
            "simulatorOutput",
            {
              status: 401,
              error: "Invalid credentials",
            },
            "error"
          );
          return;
        }

        // Generate mock JWT
        currentUser = user;
        jwtToken = `mock-jwt-token-${user.id}-${Date.now()}`;

        // Update auth status
        document.getElementById("authStatus").innerHTML = `
                <span class="status-indicator status-online"></span>
                <span>Authenticated as ${user.name}</span>
            `;

        addRequestLog("POST /auth/login", 200, "Login successful");

        displayOutput(
          "simulatorOutput",
          {
            message: "Login successful!",
            token: jwtToken,
            user: {
              id: user.id,
              name: user.name,
              email: user.email,
              role: user.role,
            },
          },
          "success"
        );
      }

      function simulateLogout() {
        currentUser = null;
        jwtToken = null;

        document.getElementById("authStatus").innerHTML = `
                <span class="status-indicator status-offline"></span>
                <span>Not authenticated</span>
            `;

        addRequestLog("POST /auth/logout", 200, "Logout successful");

        displayOutput(
          "simulatorOutput",
          {
            message: "Logout successful!",
          },
          "info"
        );
      }

      function callAPI() {
        const endpoint = document.getElementById("apiEndpoint").value;

        if (
          (!jwtToken && endpoint.includes("profile")) ||
          endpoint.includes("admin")
        ) {
          displayOutput(
            "simulatorOutput",
            {
              status: 401,
              error: "Authentication required",
              message: "Please login first to access protected endpoints",
            },
            "error"
          );
          addRequestLog(`GET ${endpoint}`, 401, "Unauthorized");
          return;
        }

        let response;

        switch (endpoint) {
          case "/api/users":
            response = {
              status: 200,
              data: mockDatabase.map((u) => ({
                id: u.id,
                name: u.name,
                email: u.email,
                role: u.role,
              })),
            };
            break;

          case "/api/users/:id":
            const randomUser =
              mockDatabase[Math.floor(Math.random() * mockDatabase.length)];
            response = {
              status: 200,
              data: {
                id: randomUser.id,
                name: randomUser.name,
                email: randomUser.email,
                role: randomUser.role,
              },
            };
            break;

          case "/api/profile":
            if (!currentUser) {
              response = { status: 401, error: "Not authenticated" };
            } else {
              response = {
                status: 200,
                data: {
                  id: currentUser.id,
                  name: currentUser.name,
                  email: currentUser.email,
                  role: currentUser.role,
                  loginTime: new Date().toISOString(),
                },
              };
            }
            break;

          case "/api/admin":
            if (!currentUser) {
              response = { status: 401, error: "Not authenticated" };
            } else if (currentUser.role !== "admin") {
              response = { status: 403, error: "Admin access required" };
            } else {
              response = {
                status: 200,
                data: {
                  message: "Welcome to admin panel!",
                  totalUsers: mockDatabase.length,
                  serverUptime: "2 hours 15 minutes",
                  adminStats: { logins: 42, errors: 3 },
                },
              };
            }
            break;

          default:
            response = { status: 404, error: "Endpoint not found" };
        }

        const statusType = response.status < 400 ? "success" : "error";
        addRequestLog(
          `GET ${endpoint}`,
          response.status,
          statusType === "success" ? "Success" : response.error
        );

        displayOutput("simulatorOutput", response, statusType);
      }

      function addRequestLog(method, status, message) {
        const monitor = document.getElementById("requestMonitor");
        const statusClass =
          status < 400 ? "success" : status < 500 ? "warning" : "error";

        const logEntry = document.createElement("div");
        logEntry.innerHTML = `
                <div style="padding: 8px; border-left: 3px solid ${
                  status < 400
                    ? "#48bb78"
                    : status < 500
                    ? "#ed8936"
                    : "#f56565"
                }; margin: 5px 0; background: #f8f9fa; font-size: 13px;">
                    <strong>${++requestCounter}.</strong> ${method} 
                    <span class="${statusClass}">[${status}]</span> 
                    ${message}
                    <br><small>${new Date().toLocaleTimeString()}</small>
                </div>
            `;

        if (
          monitor.children.length === 0 ||
          monitor.children[0].textContent.includes("No requests")
        ) {
          monitor.innerHTML = "";
        }

        monitor.insertBefore(logEntry, monitor.firstChild);

        // Keep only last 10 requests
        while (monitor.children.length > 10) {
          monitor.removeChild(monitor.lastChild);
        }
      }

      // Utility function to display output
      function displayOutput(elementId, data, type = "info") {
        const output = document.getElementById(elementId);
        const timestamp = new Date().toLocaleTimeString();

        output.innerHTML = `
                <div class="${type}">
                    <strong>[${timestamp}]</strong> ${JSON.stringify(
          data,
          null,
          2
        )}
                </div>
            `;
        output.scrollTop = output.scrollHeight;
      }

      // Initialize database display
      updateDatabaseDisplay();
      getAllCookies();
    </script>
  </body>
</html>
